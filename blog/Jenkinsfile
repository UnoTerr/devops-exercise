node { 
 /*   checkout scm
    def testImage = docker.build("blog", "blog/") 
    
    testImage.inside {
        sh 'make test'
    }
    /*    stage('Build') { 
        sh 'docker build -t blog .'
         
    }
    stage('Test') { 
       echo 'BBB'
    }
    stage('Deploy') { 
        echo'111'
    } */

    def app

    stage('Checkout code') {
        checkout scm
    }
/*
    stage('Build image') {
        //app = docker.build("blog_pipe", "-f blog/Dockerfile .")
        //sh 'ls'
        sh 'cd blog && docker-compose up --build'
    }
 */   
    stage('Deploy 1') {
        sh 'kubectl delete pods postgresql redis traefik lol'
        sh 'kubectl run postgresql --image=postgresql:latest'
        sh 'kubectl run redis --image=redis:latest'
        sh 'kubectl run traefik --image=traefik:latest'
    }

    stage('Test image') {
        //app.inside {
            sh 'echo "Tests passed"'
    //    }
    }
}